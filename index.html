<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>N0rb1n</title>
<style>
body { margin:0; font-family: monospace; background-color:#0a0a0a; color:#fff; overflow-x:hidden; }
header { display:flex; align-items:center; justify-content:space-between; background:#111; padding:10px 20px; flex-wrap: wrap; position:relative; z-index:2; }
.logo { font-size:24px; font-weight:bold; background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); -webkit-background-clip: text; color:transparent; animation: glow 2s infinite alternate; }
@keyframes glow { 0% { text-shadow:0 0 5px #fff;} 100% { text-shadow:0 0 20px #fff;} }
.menu-btn { font-size:24px; cursor:pointer; background:none; border:none; color:#fff; }
.side-menu { position:fixed; top:0; right:-250px; width:250px; height:100%; background:#222; padding:20px; display:flex; flex-direction:column; gap:10px; transition:0.3s; z-index:5; }
.side-menu button { background:#333; color:#fff; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; text-align:left; }
.side-menu button:hover { background:#444; }
.close-btn { align-self:flex-end; font-size:20px; cursor:pointer; background:none; border:none; color:#fff; margin-bottom:10px; }
.device-info { font-size:12px; color:#aaa; margin-top:10px; }
.activity { display:flex; align-items:center; margin-left:10px; color:#0f0; font-weight:bold; }
.activity-dot { width:10px; height:10px; background:red; border-radius:50%; margin-right:5px; }
.container { padding:20px; }
.section { display:none; }
input, textarea, select { width:100%; padding:10px; border-radius:5px; border:none; margin:5px 0; }
button { cursor:pointer; }
.chat-box, .private-chat-box { background:#111; padding:10px; border-radius:10px; max-height:400px; overflow-y:auto; margin-top:5px; }
.message { display:flex; align-items:center; margin:5px 0; }
.message-content { background:#222; padding:5px 10px; border-radius:5px; }
.search-result { background:#222; padding:5px; margin:5px 0; border-radius:5px; cursor:pointer; }
.search-result:hover { background:#444; }
.preview-box { background:#111; padding:10px; border-radius:10px; margin-top:10px; }
.friend-request { background:#222; padding:5px; margin:5px 0; border-radius:5px; }
.ascii-art { white-space: pre; font-size:12px; margin-bottom:10px; color:#0ff; }
@media (max-width:600px) { header { flex-direction: column; align-items:flex-start; } }
</style>
</head>
<body>

<header>
  <div class="logo">N0rb1n</div>
  <button class="menu-btn" onclick="openMenu()">☰</button>
  <div class="activity" id="activityStatus"><div class="activity-dot"></div><span id="onlineCount">0</span></div>
</header>

<div class="side-menu" id="sideMenu">
  <button class="close-btn" onclick="closeMenu()">✖</button>
  <button onclick="showSection('home'); closeMenu()">Home</button>
  <button onclick="showSection('paste'); closeMenu()">Paste</button>
  <button onclick="showSection('recent'); closeMenu()">Recent Pastes</button>
  <button onclick="showSection('hall'); closeMenu()">Hall of Autism</button>
  <button onclick="showSection('chat'); closeMenu()">Global Chat</button>
  <button onclick="showSection('friends'); closeMenu()">Friends</button>
  <button onclick="showSection('messages'); closeMenu()">Private Messages</button>
  <div class="device-info" id="deviceInfo">Device: Unknown</div>
</div>

<div class="container">

  <!-- HOME -->
  <div id="home" class="section">
    <h3>Welcome to N0rb1n!</h3>
    <div id="loginPrompt"><button onclick="showLogin()">Login / Create Account</button></div>
    <div id="asciiArt" class="ascii-art" style="display:none;">
#     #   ###                   #          
##    #  #   #  #####  #####   ##   #    # 
# #   # #     # #    # #    # # #   ##   # 
#  #  # #     # #    # #####    #   # #  # 
#   # # #     # #####  #    #   #   #  # # 
#    ##  #   #  #   #  #    #   #   #   ## 
#     #   ###   #    # #####  ##### #    #
    </div>
    <h4>Search Pastes:</h4>
    <input type="text" id="searchInput" placeholder="Search titles..." oninput="searchPastes()">
    <div id="searchResults"></div>
    <div id="previewBox" class="preview-box" style="display:none;"></div>
  </div>

  <!-- LOGIN -->
  <div id="loginSection" class="section">
    <h3>Login / Create Account</h3>
    <input type="text" id="usernameInput" placeholder="Username">
    <input type="text" id="profilePicInput" placeholder="Profile Picture URL">
    <input type="password" id="passwordInput" placeholder="Password">
    <button onclick="createAccount()">Create Account</button>
    <button onclick="loginAccount()">Login</button>
    <p id="loginMsg"></p>
  </div>

  <!-- CREATE PASTE -->
  <div id="paste" class="section">
    <h3>Create Paste</h3>
    <input type="text" id="pasteTitle" placeholder="Title">
    <textarea id="pasteContent" rows="5" placeholder="Content"></textarea>
    <input type="text" id="pasteImage" placeholder="Optional Image URL">
    <button onclick="createPaste()">Submit Paste</button>
  </div>

  <!-- RECENT PASTES -->
  <div id="recent" class="section">
    <h3>Recent Pastes</h3>
    <div id="recentPastes"></div>
  </div>

  <!-- HALL -->
  <div id="hall" class="section">
    <h3>Hall of Autism</h3>
    <div id="hallPastes"></div>
  </div>

  <!-- GLOBAL CHAT -->
  <div id="chat" class="section">
    <h3>Global Chat</h3>
    <div class="chat-box" id="chatBox"></div>
    <div class="input-area">
      <input type="text" id="chatInput" placeholder="Message">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <!-- FRIENDS -->
  <div id="friends" class="section">
    <h3>Friends</h3>
    <input type="text" id="friendUsername" placeholder="Enter username to add">
    <button onclick="sendFriendRequest()">Request</button>
    <div id="friendRequests"></div>
    <div id="friendsList"></div>
  </div>

  <!-- PRIVATE MESSAGES -->
  <div id="messages" class="section">
    <h3>Private Messages</h3>
    <select id="chatFriendSelect" onchange="loadPrivateChat()">
      <option value="">Select a friend</option>
    </select>
    <div class="private-chat-box" id="privateChatBox"></div>
    <div class="input-area">
      <input type="text" id="privateChatInput" placeholder="Message">
      <button onclick="sendPrivateMessage()">Send</button>
    </div>
  </div>

</div>

<script>
let currentUser = null;

// --- MENU ---
function openMenu(){ document.getElementById('sideMenu').style.right='0'; }
function closeMenu(){ document.getElementById('sideMenu').style.right='-250px'; }

// --- SECTION SWITCH ---
function showSection(id){
  document.querySelectorAll('.section').forEach(sec=>sec.style.display='none');
  const section = document.getElementById(id);
  if(section) section.style.display='block';
  if(id==='recent') loadRecentPastes();
  if(id==='hall') loadHall();
  if(id==='chat') loadChat();
  if(id==='friends') loadFriends();
  if(id==='messages') loadPrivateMessageInterface();
}

// --- LOGIN / ACCOUNT ---
function showLogin(){ showSection('loginSection'); }

function createAccount(){
  let user = document.getElementById('usernameInput').value.trim();
  let pass = document.getElementById('passwordInput').value;
  let pic = document.getElementById('profilePicInput').value || 'https://via.placeholder.com/30';
  let users = JSON.parse(localStorage.getItem('users')||'{}');
  if(users[user]){ document.getElementById('loginMsg').innerText='Account already exists'; return; }
  users[user]={password:pass,pic:pic,friends:[],friendRequests:[],messages:{}};
  localStorage.setItem('users',JSON.stringify(users));
  currentUser = user;
  document.getElementById('loginMsg').innerText='Account created successfully!';
  document.getElementById('loginPrompt').style.display='none';
  document.getElementById('asciiArt').style.display='block';
  loadFriends();
}

function loginAccount(){
  let user = document.getElementById('usernameInput').value.trim();
  let pass = document.getElementById('passwordInput').value;
  let users = JSON.parse(localStorage.getItem('users')||'{}');
  if(!users[user]){ document.getElementById('loginMsg').innerText='Account does not exist'; return; }
  if(users[user].password!==pass){ document.getElementById('loginMsg').innerText='Password incorrect'; return; }
  currentUser = user;
  document.getElementById('loginMsg').innerText='Logged in!';
  document.getElementById('loginPrompt').style.display='none';
  document.getElementById('asciiArt').style.display='block';
  loadFriends();
}

// --- PASTES ---
function createPaste(){
  if(!currentUser){ alert('Login first'); return; }
  let title=document.getElementById('pasteTitle').value;
  let content=document.getElementById('pasteContent').value;
  let image=document.getElementById('pasteImage').value;
  let pastes=JSON.parse(localStorage.getItem('pastes')||'[]');
  pastes.unshift({title,content,image:image||'',author:currentUser,date:Date.now()});
  localStorage.setItem('pastes',JSON.stringify(pastes));
  alert('Paste created!');
  document.getElementById('pasteTitle').value='';
  document.getElementById('pasteContent').value='';
  document.getElementById('pasteImage').value='';
  loadRecentPastes();
}

function loadRecentPastes(){
  let pastes=JSON.parse(localStorage.getItem('pastes')||'[]');
  let container=document.getElementById('recentPastes');
  container.innerHTML='';
  pastes.forEach(p=>{
    let div=document.createElement('div');
    div.innerHTML=`<strong>${p.title}</strong> by ${p.author}<br>${p.content}${p.image?'<br><img src="'+p.image+'" style="max-width:100%; margin-top:5px;">':''}`;
    container.appendChild(div);
  });
}

function searchPastes(){
  let query=document.getElementById('searchInput').value.toLowerCase();
  let pastes=JSON.parse(localStorage.getItem('pastes')||'[]');
  let container=document.getElementById('searchResults');
  container.innerHTML='';
  pastes.forEach(p=>{
    if(p.title.toLowerCase().includes(query)){
      let div=document.createElement('div');
      div.className='search-result';
      div.innerText=p.title+' by '+p.author;
      div.onclick=()=>{ showPreview(p); };
      container.appendChild(div);
    }
  });
}

function showPreview(paste){
  let box=document.getElementById('previewBox');
  box.style.display='block';
  box.innerHTML=`<strong>${paste.title}</strong> by ${paste.author}<br>${paste.content}${paste.image?'<br><img src="'+paste.image+'" style="max-width:100%; margin-top:5px;">':''}`;
}

// --- HALL ---
function loadHall(){
  let pastes=JSON.parse(localStorage.getItem('pastes')||'[]');
  let counts={};
  pastes.forEach(p=>counts[p.title]=(counts[p.title]||0)+1);
  let sorted=Object.entries(counts).sort((a,b)=>b[1]-a[1]);
  let container=document.getElementById('hallPastes');
  container.innerHTML='';
  sorted.slice(0,10).forEach(([title,count])=>{
    pastes.filter(p=>p.title===title).forEach(p=>{
      let div=document.createElement('div');
      div.innerHTML=`<strong>${p.title}</strong> (${count} times)<br>${p.content}${p.image?'<br><img src="'+p.image+'" style="max-width:100%; margin-top:5px;">':''}`;
      container.appendChild(div);
    });
  });
}

// --- FRIENDS ---
function loadFriends(){
  if(!currentUser) return;
  let users=JSON.parse(localStorage.getItem('users')||'{}');
  let userObj=users[currentUser];
  let requestsContainer=document.getElementById('friendRequests');
  requestsContainer.innerHTML='';

  // Incoming requests
  userObj.friendRequests.forEach(req=>{
    let div=document.createElement('div');
    div.className='friend-request';
    div.innerText=req+' wants to be your friend ';
    let acceptBtn=document.createElement('button');
    acceptBtn.innerText='Accept';
    acceptBtn.onclick=()=>{
      userObj.friends.push(req);
      users[req].friends.push(currentUser);
      userObj.friendRequests=userObj.friendRequests.filter(r=>r!==req);
      localStorage.setItem('users',JSON.stringify(users));
      loadFriends();
    };
    let denyBtn=document.createElement('button');
    denyBtn.innerText='Deny';
    denyBtn.onclick=()=>{
      userObj.friendRequests=userObj.friendRequests.filter(r=>r!==req);
      localStorage.setItem('users',JSON.stringify(users));
      loadFriends();
    };
    div.appendChild(acceptBtn);
    div.appendChild(denyBtn);
    requestsContainer.appendChild(div);
  });

  // Friends list
  let friendsContainer=document.getElementById('friendsList');
  friendsContainer.innerHTML='';
  userObj.friends.forEach(f=>{
    let div=document.createElement('div');
    div.innerText=f;
    friendsContainer.appendChild(div);
  });

  // Update private message selector
  let select=document.getElementById('chatFriendSelect');
  select.innerHTML='<option value="">Select a friend</option>';
  userObj.friends.forEach(f=>{ select.innerHTML+='<option value="'+f+'">'+f+'</option>'; });
}

function sendFriendRequest(){
  if(!currentUser) return;
  let target=document.getElementById('friendUsername').value.trim();
  if(!target) return alert('Enter username');
  let users=JSON.parse(localStorage.getItem('users')||'{}');
  if(!users[target]) return alert('User does not exist');
  if(users[target].friendRequests.includes(currentUser) || users[target].friends.includes(currentUser)) return alert('Already requested or already friends');
  users[target].friendRequests.push(currentUser);
  localStorage.setItem('users',JSON.stringify(users));
  alert('Request sent!');
  document.getElementById('friendUsername').value='';
  loadFriends();
}

// --- PRIVATE MESSAGES ---
function loadPrivateMessageInterface(){ loadFriends(); document.getElementById('privateChatBox').innerHTML=''; }

function loadPrivateChat(){
  let friend=document.getElementById('chatFriendSelect').value;
  if(!friend) return;
  let users=JSON.parse(localStorage.getItem('users')||'{}');
  let msgs=users[currentUser].messages[friend]||[];
  let box=document.getElementById('privateChatBox');
  box.innerHTML='';
  msgs.forEach(m=>{
    let div=document.createElement('div');
    div.className='message-content';
    div.innerText=m.sender+': '+m.text;
    box.appendChild(div);
  });
  box.scrollTop=box.scrollHeight;
}

function sendPrivateMessage(){
  let friend=document.getElementById('chatFriendSelect').value;
  if(!friend) return alert('Select friend');
  let text=document.getElementById('privateChatInput').value.trim();
  if(!text) return;
  let users=JSON.parse(localStorage.getItem('users')||'{}');
  if(!users[currentUser].messages[friend]) users[currentUser].messages[friend]=[];
  if(!users[friend].messages[currentUser]) users[friend].messages[currentUser]=[];
  users[currentUser].messages[friend].push({sender:currentUser,text});
  users[friend].messages[currentUser].push({sender:currentUser,text});
  localStorage.setItem('users',JSON.stringify(users));
  document.getElementById('privateChatInput').value='';
  loadPrivateChat();
}

// --- GLOBAL CHAT ---
function loadChat(){ 
  let chat=JSON.parse(localStorage.getItem('globalChat')||'[]'); 
  let box=document.getElementById('chatBox');
  box.innerHTML='';
  chat.forEach(m=>{ 
    let div=document.createElement('div'); 
    div.className='message-content'; 
    div.innerText=m.sender+': '+m.text;
    box
