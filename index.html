<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Norbin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}body{margin:0;background:#0b0b0b;color:#f1f1f1;font-family:monospace;}
.topbar{position:fixed;top:0;left:0;width:100%;height:50px;z-index:2000;display:flex;align-items:center;padding:0 15px;background:#0b0b0b;border-bottom:2px solid #333;}
.menu-btn{font-size:24px;cursor:pointer;user-select:none;margin-right:10px;}
.brand{font-size:20px;font-weight:bold;color:#ff0000;text-shadow:0 0 5px #ff0000,0 0 10px #ff0000,0 0 20px #ff0000;}
.side-menu{position:fixed;top:0;left:-260px;width:260px;height:100%;background:#111;border-right:2px solid #222;padding:60px 15px 15px;transition:left 0.3s ease;z-index:1000;}
.side-menu.open{left:0}.side-menu h2{margin-top:0;margin-bottom:15px}.side-menu button{width:100%;padding:12px;margin-bottom:10px;background:#1a1a1a;color:#fff;border:1px solid #333;cursor:pointer;}.side-menu button:hover{background:#222}
.container{max-width:900px;margin:auto;padding:70px 20px 20px;}
.search{width:100%;padding:14px;font-size:16px;background:#111;color:#fff;border:2px solid #333;outline:none;}
.section{margin-top:25px}.section h2{border-bottom:1px solid #222}
.paste{padding:12px;background:#111;border:1px solid #222;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}.paste:hover{background:#151515}
.hidden{display:none}.paste-box{background:#111;border:2px solid #222;padding:15px;max-height:65vh;overflow-y:auto;white-space:pre-wrap;}
.input,textarea{width:100%;background:#111;color:#fff;border:2px solid #333;padding:12px;margin-bottom:10px;}textarea{min-height:200px;resize:vertical}
.form-buttons{display:flex;gap:10px}.form-buttons button{flex:1;padding:12px;border:none;cursor:pointer;}.publish{background:#2a7}.clear{background:#922}
.user-tag{font-weight:bold;margin-left:5px;}.owner-tag{color:red;text-shadow:0 0 5px red,0 0 10px red,0 0 20px red;}.admin-tag{color:darkblue;text-shadow:0 0 5px darkblue,0 0 10px darkblue,0 0 20px darkblue;}
.follow-btn{padding:5px 10px;background:#2a7;border:none;color:#fff;cursor:pointer;}
.admin-btn{padding:4px 8px;background:#922;border:none;color:#fff;cursor:pointer;margin-left:5px;}
.pin-btn{padding:4px 8px;background:#2a7;border:none;color:#fff;cursor:pointer;margin-left:5px;}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore-compat.js"></script>
</head>
<body>

<div class="topbar">
  <div class="menu-btn" onclick="toggleMenu()">â˜°</div>
  <div class="brand">Norbin</div>
</div>

<div class="side-menu" id="menu">
  <h2>Menu</h2>
  <button onclick="goHome()">Home</button>
  <button onclick="openPaste()">Paste</button>
  <button id="loginBtn" onclick="openLogin()">Login</button>
  <button id="signupBtn" onclick="openSignup()">Sign up</button>
  <button id="accountBtn" class="hidden" onclick="openAccount()">My Account</button>
  <button id="roleCodeBtn" class="hidden" onclick="openRoleCode()">Role Code</button>
  <button id="adminPanelBtn" class="hidden" onclick="openAdminPanel()">Admin Panel</button>
</div>

<div class="container">

<div id="home">
  <input class="search" placeholder="Search pastes..." oninput="search(this.value)">
  <div class="section"><h2>Pinned Pastes</h2><div id="pinned"></div></div>
  <div class="section"><h2>Recent Pastes</h2><div id="recent"></div></div>
</div>

<div id="view" class="hidden">
  <div style="margin-bottom:10px;">Author: <span id="viewAuthor" style="cursor:pointer;text-decoration:underline;"></span> | <span id="viewTime"></span></div>
  <div class="paste-box" id="viewContent"></div>
</div>

<div id="create" class="hidden">
  <input class="input" id="pasteTitle" placeholder="Paste title">
  <textarea id="pasteText" placeholder="Paste content"></textarea>
  <div class="form-buttons">
    <button class="publish" onclick="publishPaste()">Publish</button>
    <button class="clear" onclick="clearPaste()">Clear</button>
  </div>
</div>

<div id="login" class="hidden">
  <h2>Login</h2>
  <input class="input" id="loginUser" placeholder="Email">
  <input class="input" id="loginPass" type="password" placeholder="Password">
  <div class="form-buttons">
    <button class="publish" onclick="login()">Login</button>
    <button class="clear" onclick="goHome()">Cancel</button>
  </div>
</div>

<div id="signup" class="hidden">
  <h2>Sign Up</h2>
  <input class="input" id="signupUser" placeholder="Email">
  <input class="input" id="signupPass" type="password" placeholder="Password">
  <div class="form-buttons">
    <button class="publish" onclick="signup()">Sign up</button>
    <button class="clear" onclick="goHome()">Cancel</button>
  </div>
</div>

<div id="roleCode" class="hidden">
  <h2>Enter Role Code</h2>
  <input class="input" id="roleInput" placeholder="Enter code here">
  <div class="form-buttons">
    <button class="publish" onclick="enterRoleCode()">Submit</button>
    <button class="clear" onclick="goHome()">Cancel</button>
  </div>
</div>

<div id="account" class="hidden">
  <h2>Account</h2>
  <p id="accName"></p>
  <div id="userPastes"></div>
  <button class="clear" onclick="logout()">Log out</button>
</div>

<div id="adminPanel" class="hidden">
  <h2>Admin Panel</h2>
  <div id="adminControls">
    <h3>Users</h3>
    <div id="userList"></div>
    <h3>All Pastes</h3>
    <div id="pasteList"></div>
  </div>
</div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBN29E6HxcBEAum3BU2ntbXWUfe6my9oy8",
  authDomain: "n0rb1n.firebaseapp.com",
  projectId: "n0rb1n",
  storageBucket: "n0rb1n.firebasestorage.app",
  messagingSenderId: "269496774941",
  appId: "1:269496774941:web:74d9e873abbe707bdb31f4",
  measurementId: "G-RBYY7TFED8"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let pastes = [];

// DOM References
const login = document.getElementById("login");
const signup = document.getElementById("signup");
const home = document.getElementById("home");
const create = document.getElementById("create");
const view = document.getElementById("view");
const account = document.getElementById("account");
const roleCode = document.getElementById("roleCode");
const adminPanel = document.getElementById("adminPanel");

// MENU
function toggleMenu(){document.getElementById("menu").classList.toggle("open");}
function hideAll(){document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden"));}
function goHome(){hideAll();home.classList.remove("hidden");}
function openPaste(){hideAll();create.classList.remove("hidden");}
function openLogin(){hideAll();login.classList.remove("hidden");}
function openSignup(){hideAll();signup.classList.remove("hidden");}
function openAccount(){hideAll();account.classList.remove("hidden");loadUserAccount(currentUser);}
function openRoleCode(){hideAll();roleCode.classList.remove("hidden");}
function openAdminPanel(){hideAll();adminPanel.classList.remove("hidden");loadAdminPanel();}

// AUTH
function signup(){
  const email = signupUser.value.trim();
  const pass = signupPass.value.trim();
  if(!email||!pass) return alert("Fill email & password");
  auth.createUserWithEmailAndPassword(email,pass).then(()=>{
    db.collection("users").doc(email).set({followers: [], role:null});
    currentUser = email; updateAuth(); goHome();
  }).catch(e=>alert(e.message));
}
function login(){
  const email = loginUser.value.trim();
  const pass = loginPass.value.trim();
  if(!email||!pass) return alert("Fill email & password");
  auth.signInWithEmailAndPassword(email,pass).then(()=>{currentUser=email;updateAuth();goHome();}).catch(e=>alert(e.message));
}
function logout(){auth.signOut();currentUser=null;updateAuth();goHome();}
function updateAuth(){
  loginBtn.classList.toggle("hidden",!!currentUser);
  signupBtn.classList.toggle("hidden",!!currentUser);
  accountBtn.classList.toggle("hidden",!currentUser);
  roleCodeBtn.classList.toggle("hidden",!currentUser);
  checkAdminRole();
}

// CHECK ADMIN/OWNER FOR ADMIN PANEL
function checkAdminRole(){
  if(!currentUser){adminPanelBtn.classList.add("hidden"); return;}
  db.collection("users").doc(currentUser).get().then(doc=>{
    const role = doc.data()?.role;
    adminPanelBtn.classList.toggle("hidden",!(role==="admin"||role==="owner"));
  });
}

// PASTES
function publishPaste(){
  if(!currentUser) return alert("Login");
  const t=pasteTitle.value.trim(), c=pasteText.value.trim();
  if(!t||!c) return alert("Fill");
  db.collection("pastes").add({title:t,text:c,author:currentUser,time:Date.now(),pinned:false});
  clearPaste(); goHome();
}
function clearPaste(){pasteTitle.value="";pasteText.value="";}

// FETCH PASTES
db.collection("pastes").orderBy("time","desc").onSnapshot(snap=>{
  pastes = snap.docs.map(doc=>({id:doc.id,...doc.data()}));
  renderPastes();
});

// RENDER PASTES
function renderPastes(){
  pinned.innerHTML=""; recent.innerHTML="";
  pastes.forEach(p=>{
    const div=document.createElement("div"); div.className="paste";
    div.innerHTML=`<span>${p.title}</span><span style="cursor:pointer;text-decoration:underline;color:#2a7;" onclick="viewUser('${p.author}')">${p.author}${p.role?` <span class='user-tag ${p.role}-tag'>(${p.role})</span>`:""}</span>`;
    div.onclick=()=>viewPaste(p);
    if(p.pinned) pinned.appendChild(div); else recent.appendChild(div);
  });
}

function viewPaste(p){
  hideAll(); view.classList.remove("hidden");
  viewContent.textContent=p.text;
  viewAuthor.textContent=p.author;
  viewAuthor.onclick=()=>viewUser(p.author);
  viewTime.textContent=new Date(p.time).toLocaleString();
}

// USER PROFILE
function viewUser(u){
  hideAll(); account.classList.remove("hidden");
  loadUserAccount(u);
}
function loadUserAccount(u){
  accName.textContent="User: "+u;
  userPastes.innerHTML="";
  pastes.filter(p=>p.author===u).forEach(p=>{
    const d=document.createElement("div"); d.className="paste"; d.textContent=p.title+(p.pinned?" (Pinned)":"");
    d.onclick=()=>viewPaste(p); userPastes.appendChild(d);
  });
  db.collection("users").doc(u).get().then(doc=>{
    let followers = doc.data()?.followers||[];
    let btn=document.createElement("button"); btn.className="follow-btn";
    if(u===currentUser){btn.disabled=true; btn.textContent="This is you";}
    else{btn.textContent=followers.includes(currentUser)?"Following":"Follow";
      btn.onclick=()=>toggleFollow(u,btn);}
    userPastes.appendChild(btn);
    const fcount=document.createElement("p"); fcount.textContent="Followers: "+followers.length; fcount.id="fcount"; userPastes.appendChild(fcount);
  });
}
function toggleFollow(u,btn){
  db.collection("users").doc(u).get().then(doc=>{
    let followers = doc.data()?.followers||[];
    if(followers.includes(currentUser)) followers = followers.filter(x=>x!==currentUser);
    else followers.push(currentUser);
    db.collection("users").doc(u).update({followers});
    btn.textContent = followers.includes(currentUser)?"Following":"Follow";
    document.getElementById("fcount").textContent="Followers: "+followers.length;
  });
}

// ROLE CODE
function enterRoleCode(){
  const code=roleInput.value.trim();
  if(!currentUser) return alert("Login first");
  let role=null;
  if(code==="swaggyboiii50-owner") role="owner";
  else if(code==="norbin-admin-svensixty") role="admin";
  else return alert("Invalid code");
  db.collection("users").doc(currentUser).update({role}).then(()=>{alert(role+" activated"); updateAuth(); goHome();});
}

// SEARCH
function search(q){
  const qLower=q.toLowerCase();
  pinned.innerHTML=""; recent.innerHTML="";
  pastes.filter(p=>p.title.toLowerCase().includes(qLower)).forEach(p=>{
    const div=document.createElement("div"); div.className="paste";
    div.innerHTML=`<span>${p.title}</span><span style="cursor:pointer;text-decoration:underline;color:#2a7;" onclick="viewUser('${p.author}')">${p.author}</span>`;
    div.onclick=()=>viewPaste(p);
    if(p.pinned) pinned.appendChild(div); else recent.appendChild(div);
  });
}

// ADMIN PANEL
function loadAdminPanel(){
  userList.innerHTML=""; pasteList.innerHTML="";
  db.collection("users").get().then(usersSnap=>{
    usersSnap.forEach(doc=>{
      const u = doc.id; const role = doc.data()?.role;
      const div=document.createElement("div"); div.textContent=u + (role==="owner"?" (Owner)":role==="admin"?" (Admin)":"");
      if(role!=="owner"){const b=document.createElement("button"); b.className="admin-btn"; b.textContent="Ban"; b.onclick=()=>banUser(u); div.appendChild(b);}
      userList.appendChild(div);
    });
  });
  db.collection("pastes").get().then(pasteSnap=>{
    pasteSnap.forEach(doc=>{
      const p = doc.data(); const div=document.createElement("div");
      div.textContent=`${p.title} by ${p.author}` + (p.pinned?" (Pinned)":"");
      if(currentUser){const b=document.createElement("button"); b.className="admin-btn"; b.textContent="Delete"; b.onclick=()=>deletePaste(doc.id); div.appendChild(b);
        const pinBtn=document.createElement("button"); pinBtn.className="pin-btn"; pinBtn.textContent=p.pinned?"Unpin":"Pin"; pinBtn.onclick=()=>togglePin(doc.id,p.pinned); div.appendChild(pinBtn);}
      pasteList.appendChild(div);
    });
  });
}
function banUser(u){if(confirm("Ban "+u+"?")){db.collection("users").doc(u).delete(); db.collection("pastes").where("author","==",u).get().then(s=>{s.forEach(doc=>doc.ref.delete());}); loadAdminPanel();}}
function deletePaste(id){if(confirm("Delete paste?")){db.collection("pastes").doc(id).delete(); loadAdminPanel();}}
function togglePin(id,pinned){db.collection("pastes").doc(id).update({pinned:!pinned}); loadAdminPanel();}

// INIT AUTH
auth.onAuthStateChanged(u=>{
  currentUser = u?u.email:null;
  updateAuth();
  goHome();
});
</script>

</body>
</html>
