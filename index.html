<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Norbin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}
body{margin:0;background:#0b0b0b;color:#f1f1f1;font-family:monospace;}
.topbar{position:fixed;top:0;left:0;width:100%;height:50px;z-index:2000;display:flex;align-items:center;padding:0 15px;background:#0b0b0b;border-bottom:2px solid #333;}
.menu-btn{font-size:24px;cursor:pointer;user-select:none;margin-right:10px;}
.brand{font-size:20px;font-weight:bold;color:#ff0000;text-shadow:0 0 5px #ff0000,0 0 10px #ff0000,0 0 20px #ff0000;}
.side-menu{position:fixed;top:0;left:-260px;width:260px;height:100%;background:#111;border-right:2px solid #222;padding:60px 15px 15px;transition:left 0.3s ease;z-index:1000;}
.side-menu.open{left:0}
.side-menu h2{margin-top:0;margin-bottom:15px}
.side-menu button{width:100%;padding:12px;margin-bottom:10px;background:#1a1a1a;color:#fff;border:1px solid #333;cursor:pointer;}
.side-menu button:hover{background:#222}
.container{max-width:900px;margin:auto;padding:70px 20px 20px;}
.search{width:100%;padding:14px;font-size:16px;background:#111;color:#fff;border:2px solid #333;outline:none;}
.section{margin-top:25px}
.section h2{border-bottom:1px solid #222}
.paste{padding:12px;background:#111;border:1px solid #222;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.paste:hover{background:#151515}
.hidden{display:none}
.paste-box{background:#111;border:2px solid #222;padding:15px;max-height:65vh;overflow-y:auto;white-space:pre-wrap;}
.input,textarea{width:100%;background:#111;color:#fff;border:2px solid #333;padding:12px;margin-bottom:10px;}
textarea{min-height:200px;resize:vertical}
.form-buttons{display:flex;gap:10px}
.form-buttons button{flex:1;padding:12px;border:none;cursor:pointer;}
.publish{background:#2a7}
.clear{background:#922}
.user-tag{font-weight:bold;margin-left:5px;}
.owner-tag{color:red;text-shadow:0 0 5px red,0 0 10px red,0 0 20px red;}
.admin-tag{color:darkblue;text-shadow:0 0 5px darkblue,0 0 10px darkblue,0 0 20px darkblue;}
.follow-btn{padding:5px 10px;background:#2a7;border:none;color:#fff;cursor:pointer;}
</style>
</head>
<body>

<div class="topbar">
  <div class="menu-btn" onclick="toggleMenu()">â˜°</div>
  <div class="brand">Norbin</div>
</div>

<div class="side-menu" id="menu">
  <h2>Menu</h2>
  <button onclick="goHome()">Home</button>
  <button onclick="openPaste()">Paste</button>
  <button id="loginBtn" onclick="openLogin()">Login</button>
  <button id="signupBtn" onclick="openSignup()">Sign up</button>
  <button id="accountBtn" class="hidden" onclick="openAccount()">My Account</button>
  <button id="adminPanelBtn" class="hidden" onclick="openAdminPanel()">Admin Panel</button>
</div>

<div class="container">

<!-- HOME -->
<div id="home">
  <input class="search" placeholder="Search pastes..." oninput="search(this.value)">
  
  <div class="section">
    <h2>Pinned Pastes</h2>
    <div id="pinned"></div>
  </div>
  
  <div class="section">
    <h2>Recent Pastes</h2>
    <div id="recent"></div>
  </div>
</div>

<!-- VIEW PASTE -->
<div id="view" class="hidden">
  <div style="margin-bottom:10px;">Author: <span id="viewAuthor" style="cursor:pointer;text-decoration:underline;"></span> | <span id="viewTime"></span></div>
  <div class="paste-box" id="viewContent"></div>
</div>

<!-- CREATE PASTE -->
<div id="create" class="hidden">
  <input class="input" id="pasteTitle" placeholder="Paste title">
  <textarea id="pasteText" placeholder="Paste content"></textarea>
  <div class="form-buttons">
    <button class="publish" onclick="publishPaste()">Publish</button>
    <button class="clear" onclick="clearPaste()">Clear</button>
  </div>
</div>

<!-- LOGIN PAGE -->
<div id="login" class="hidden">
  <input class="input" id="loginUser" placeholder="Username">
  <input class="input" id="loginPass" type="password" placeholder="Password">
  <div class="form-buttons">
    <button class="publish" onclick="login()">Login</button>
    <button class="clear" onclick="goHome()">Cancel</button>
  </div>
</div>

<!-- SIGNUP PAGE -->
<div id="signup" class="hidden">
  <input class="input" id="signupUser" placeholder="Username">
  <input class="input" id="signupPass" type="password" placeholder="Password">
  <div class="form-buttons">
    <button class="publish" onclick="signup()">Sign up</button>
    <button class="clear" onclick="goHome()">Cancel</button>
  </div>
</div>

<!-- ACCOUNT PAGE -->
<div id="account" class="hidden">
  <h2>My Account</h2>
  <p id="accName"></p>
  <div id="userPastes"></div>
  <button class="clear" onclick="logout()">Log out</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
  <h2>Admin Panel</h2>
  <input class="input" id="adminCode" placeholder="Enter admin/owner code">
  <button class="publish" onclick="enterAdminCode()">Submit</button>
  <div id="adminControls"></div>
</div>

</div>

<script>
/* ---------- STATE ---------- */
let pastes = JSON.parse(localStorage.getItem("pastes")||"[]");
let pinnedPastes = JSON.parse(localStorage.getItem("pinned")||"[]");
let users = JSON.parse(localStorage.getItem("users")||"{}");
let followers = JSON.parse(localStorage.getItem("followers")||"{}"); // username => array of followers
let currentUser = localStorage.getItem("currentUser");
let admins = JSON.parse(localStorage.getItem("admins")||"{}"); // username=>role ('owner','admin')

/* ---------- MENU ---------- */
function toggleMenu(){document.getElementById("menu").classList.toggle("open");}

/* ---------- NAV ---------- */
function hideAll(){document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));}
function goHome(){hideAll();home.classList.remove("hidden");render();}
function openPaste(){hideAll();create.classList.remove("hidden");}
function openLogin(){hideAll();login.classList.remove("hidden");}
function openSignup(){hideAll();signup.classList.remove("hidden");}
function openAccount(){hideAll();account.classList.remove("hidden");loadUserAccount(currentUser);}
function openAdminPanel(){hideAll();adminPanel.classList.remove("hidden");}

/* ---------- AUTH ---------- */
function signup(){
  if(!signupUser.value||!signupPass.value)return alert("Fill username & password");
  if(users[signupUser.value])return alert("User exists");
  users[signupUser.value]=signupPass.value;
  localStorage.setItem("users",JSON.stringify(users));
  followers[signupUser.value]=[];
  localStorage.setItem("followers",JSON.stringify(followers));
  currentUser=signupUser.value;
  localStorage.setItem("currentUser",currentUser);
  updateAuth();
}
function login(){
  if(!loginUser.value||!loginPass.value)return alert("Fill username & password");
  if(users[loginUser.value]!==loginPass.value)return alert("Invalid");
  currentUser=loginUser.value;
  localStorage.setItem("currentUser",currentUser);
  updateAuth();
}
function logout(){localStorage.removeItem("currentUser");currentUser=null;updateAuth();goHome();}
function updateAuth(){
  loginBtn.classList.toggle("hidden",!!currentUser);
  signupBtn.classList.toggle("hidden",!!currentUser);
  accountBtn.classList.toggle("hidden",!currentUser);
  // show admin panel only if current user is admin or owner
  adminPanelBtn.classList.toggle("hidden",!(currentUser && admins[currentUser]));
}

/* ---------- PASTE ---------- */
function publishPaste(){
  if(!currentUser)return alert("You must be logged in");
  const title=pasteTitle.value.trim();
  const text=pasteText.value.trim();
  if(!title||!text)return alert("Fill everything");
  pastes.unshift({title,text,author:currentUser,time:Date.now()});
  localStorage.setItem("pastes",JSON.stringify(pastes));
  clearPaste();goHome();
}
function clearPaste(){pasteTitle.value="";pasteText.value="";}
function render(){
  // Pinned
  pinned.innerHTML="";
  pinnedPastes.forEach(p=>{
    const d=document.createElement("div");
    d.className="paste";
    d.innerHTML=`<span>${p.title}</span><span style="cursor:pointer;text-decoration:underline;color:#2a7;" onclick="viewUser('${p.author}')">${p.author}${getTag(p.author)}</span>`;
    d.onclick=e=>{if(e.target.tagName!=="SPAN"){viewPaste(p)}};
    pinned.appendChild(d);
  });
  // Recent
  recent.innerHTML="";
  pastes.forEach(p=>{
    const d=document.createElement("div");
    d.className="paste";
    d.innerHTML=`<span>${p.title}</span><span style="cursor:pointer;text-decoration:underline;color:#2a7;" onclick="viewUser('${p.author}')">${p.author}${getTag(p.author)}</span>`;
    d.onclick=e=>{if(e.target.tagName!=="SPAN"){viewPaste(p)}};
    recent.appendChild(d);
  });
}
function search(q){
  pinned.innerHTML="";recent.innerHTML="";
  pinnedPastes.filter(p=>p.title.toLowerCase().includes(q.toLowerCase())).forEach(p=>{
    const d=document.createElement("div");
    d.className="paste";
    d.innerHTML=`<span>${p.title}</span><span style="cursor:pointer;text-decoration:underline;color:#2a7;" onclick="viewUser('${p.author}')">${p.author}${getTag(p.author)}</span>`;
    d.onclick=e=>{if(e.target.tagName!=="SPAN"){viewPaste(p)}};
    pinned.appendChild(d);
  });
  pastes.filter(p=>p.title.toLowerCase().includes(q.toLowerCase())).forEach(p=>{
    const d=document.createElement("div");
    d.className="paste";
    d.innerHTML=`<span>${p.title}</span><span style="cursor:pointer;text-decoration:underline;color:#2a7;" onclick="viewUser('${p.author}')">${p.author}${getTag(p.author)}</span>`;
    d.onclick=e=>{if(e.target.tagName!=="SPAN"){viewPaste(p)}};
    recent.appendChild(d);
  });
}

/* ---------- VIEW PASTE ---------- */
function viewPaste(p){
  hideAll();view.classList.remove("hidden");
  viewContent.textContent=p.text;
  viewAuthor.textContent=p.author;
  viewAuthor.onclick=()=>viewUser(p.author);
  viewTime.textContent=new Date(p.time).toLocaleString();
}

/* ---------- USER PROFILES ---------- */
function viewUser(username){
  hideAll();account.classList.remove("hidden");
  loadUserAccount(username);
}
function loadUserAccount(username){
  accName.textContent="User: "+username+getTag(username);
  userPastes.innerHTML="";
  const userP=pastes.filter(p=>p.author===username);
  userP.forEach(p=>{
    const d=document.createElement("div");
    d.className="paste";
    d.textContent=p.title;
    d.onclick=()=>viewPaste(p);
    userPastes.appendChild(d);
  });
  // Follow button
  let btn=document.createElement("button");
  btn.className="follow-btn";
  if(username===currentUser){btn.disabled=true;btn.textContent="This is you";} 
  else {btn.textContent=followers[username]?.includes(currentUser)?"Following":"Follow";btn.onclick=()=>toggleFollow(username,btn);}
  userPastes.appendChild(btn);
  // Follower count
  const fcount=document.createElement("p");
  fcount.textContent="Followers: "+(followers[username]?.length||0);
  fcount.id="fcount";
  userPastes.appendChild(fcount);
}
function toggleFollow(username,btn){
  if(!currentUser)return alert("Login first");
  if(!followers[username])followers[username]=[];
  if(followers[username].includes(currentUser)){
    followers[username]=followers[username].filter(u=>u!==currentUser);btn.textContent="Follow";
  }else{followers[username].push(currentUser);btn.textContent="Following";}
  localStorage.setItem("followers",JSON.stringify(followers));
  document.getElementById("fcount").textContent="Followers: "+followers[username].length;
}

/* ---------- ADMIN PANEL ---------- */
function enterAdminCode(){
  const code=document.getElementById("adminCode").value.trim();
  if(code==="swaggyboiii50-owner"){admins[currentUser]="owner";alert("Owner activated");updateAuth();}
  else if(code==="norbin-admin-svensixty"){admins[currentUser]="admin";alert("Admin activated");updateAuth();}
  else alert("Invalid code");
  localStorage.setItem("admins",JSON.stringify(admins));
}
function getTag(username){
  if(admins[username]==="owner")return ' <span class="user-tag owner-tag">(Norbin Owner)</span>';
  if(admins[username]==="admin")return ' <span class="user-tag admin-tag">(Norbin Admin)</span>';
  return '';
}

/* ---------- INIT ---------- */
updateAuth();
render();
</script>

</body>
</html>
