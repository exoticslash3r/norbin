<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Norbin Full</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:monospace;}
body{background:#0b0b0b;color:#fff;}
.topbar{position:fixed;top:0;left:0;width:100%;height:50px;background:#111;display:flex;align-items:center;padding:0 15px;z-index:2000;}
.brand{color:#ff0000;font-weight:bold;font-size:20px;margin-left:10px;}
.menu-btn{cursor:pointer;font-size:24px;}
.top-menu{position:fixed;top:-500px;left:0;width:100%;background:#111;z-index:1500;flex-direction:column;display:flex;align-items:center;transition:top 0.3s;}
.top-menu.open{top:50px;}
.top-menu button{width:90%;margin:8px 0;padding:12px;background:#222;border:none;color:#fff;cursor:pointer;}
.top-menu button:hover{background:#333;}
.container{max-width:900px;margin:70px auto 20px;padding:0 10px;}
.input,textarea{width:100%;padding:12px;margin-bottom:10px;background:#111;color:#fff;border:2px solid #333;}
textarea{min-height:150px;resize:vertical;}
.form-buttons{display:flex;gap:10px;margin-bottom:10px;}
.form-buttons button{flex:1;padding:12px;border:none;cursor:pointer;}
.publish{background:#2a7;}
.clear{background:#922;}
.paste{padding:12px;background:#111;border:1px solid #222;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.paste:hover{background:#151515;}
.hidden{display:none;}
#chatBtn{position:fixed;bottom:20px;right:20px;padding:10px 20px;background:#2a7;color:#fff;border:none;cursor:pointer;border-radius:5px;z-index:3000;}
#chatPanel{position:fixed;bottom:70px;right:20px;width:300px;max-width:90vw;height:400px;background:#111;border:2px solid #222;padding:10px;display:none;flex-direction:column;z-index:3000;}
#chatMessages{flex:1;overflow-y:auto;border:1px solid #333;padding:5px;margin-bottom:5px;}
#chatInput{width:100%;padding:10px;background:#111;border:2px solid #333;color:#fff;}
.section{margin-top:25px;}
.section h2{border-bottom:1px solid #222;margin-bottom:5px;}
@media(max-width:600px){
  #chatPanel{width:90vw;right:5%;bottom:70px;height:50vh;}
}
</style>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore-compat.js"></script>
</head>
<body>

<div class="topbar">
  <div class="menu-btn" onclick="toggleMenu()">â˜°</div>
  <div class="brand">Norbin</div>
</div>

<div class="top-menu" id="menu">
  <button onclick="goHome()">Home</button>
  <button onclick="openPaste()">Create Paste</button>
  <button id="loginBtn" onclick="openLogin()">Login</button>
  <button id="signupBtn" onclick="openSignup()">Sign Up</button>
  <button id="accountBtn" class="hidden" onclick="openAccount()">My Account</button>
  <button id="roleCodeBtn" class="hidden" onclick="openRoleCode()">Role Code</button>
  <button id="adminPanelBtn" class="hidden" onclick="openAdminPanel()">Admin Panel</button>
</div>

<div class="container">
  <div id="home">
    <input class="input" placeholder="Search pastes..." oninput="searchPastes(this.value)">
    <div class="section"><h2>Pinned Pastes</h2><div id="pinned"></div></div>
    <div class="section"><h2>Recent Pastes</h2><div id="recent"></div></div>
  </div>

  <div id="create" class="hidden">
    <input class="input" id="pasteTitle" placeholder="Paste Title">
    <textarea id="pasteText" placeholder="Paste Content"></textarea>
    <div class="form-buttons">
      <button class="publish" onclick="publishPaste()">Publish</button>
      <button class="clear" onclick="clearPaste()">Clear</button>
    </div>
  </div>

  <div id="login" class="hidden">
    <h2>Login</h2>
    <input class="input" id="loginEmail" placeholder="Email">
    <input class="input" id="loginPass" type="password" placeholder="Password">
    <div class="form-buttons">
      <button class="publish" onclick="loginFunc()">Login</button>
      <button class="clear" onclick="goHome()">Cancel</button>
    </div>
  </div>

  <div id="signup" class="hidden">
    <h2>Sign Up</h2>
    <input class="input" id="signupEmail" placeholder="Email">
    <input class="input" id="signupPass" type="password" placeholder="Password">
    <div class="form-buttons">
      <button class="publish" onclick="signupFunc()">Sign Up</button>
      <button class="clear" onclick="goHome()">Cancel</button>
    </div>
  </div>

  <div id="account" class="hidden">
    <h2>Account</h2>
    <p id="accName"></p>
    <div class="form-buttons">
      <button class="publish" onclick="updateUsername()">Update Username</button>
    </div>
    <div id="userPastes"></div>
    <button class="clear" onclick="logout()">Log out</button>
  </div>

  <div id="roleCode" class="hidden">
    <h2>Enter Role Code</h2>
    <input class="input" id="roleInput" placeholder="Enter code">
    <div class="form-buttons">
      <button class="publish" onclick="enterRoleCode()">Submit</button>
      <button class="clear" onclick="goHome()">Cancel</button>
    </div>
  </div>

  <div id="adminPanel" class="hidden">
    <h2>Admin Panel</h2>
    <button onclick="togglePermissions()">Permissions</button>
    <div id="permissionsPanel" class="hidden">
      <h3>Users</h3><div id="userList"></div>
      <h3>Pastes</h3><div id="pasteList"></div>
    </div>
  </div>
</div>

<button id="chatBtn" onclick="toggleChat()">Chat</button>
<div id="chatPanel">
  <div id="chatMessages"></div>
  <input id="chatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter'){sendChat()}">
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBN29E6HxcBEAum3BU2ntbXWUfe6my9oy8",
  authDomain: "n0rb1n.firebaseapp.com",
  projectId: "n0rb1n",
  storageBucket: "n0rb1n.appspot.com",
  messagingSenderId: "269496774941",
  appId: "1:269496774941:web:74d9e873abbe707bdb31f4"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

let currentUser=null;
const pinned=document.getElementById("pinned");
const recent=document.getElementById("recent");

function toggleMenu(){document.getElementById("menu").classList.toggle("open");}
function hideAll(){document.querySelectorAll(".container>div").forEach(d=>d.classList.add("hidden"));}
function goHome(){hideAll();document.getElementById("home").classList.remove("hidden");}
function openPaste(){hideAll();document.getElementById("create").classList.remove("hidden");}
function openLogin(){hideAll();document.getElementById("login").classList.remove("hidden");}
function openSignup(){hideAll();document.getElementById("signup").classList.remove("hidden");}
function openAccount(){hideAll();document.getElementById("account").classList.remove("hidden");loadAccount();}
function openRoleCode(){hideAll();document.getElementById("roleCode").classList.remove("hidden");}
function openAdminPanel(){hideAll();document.getElementById("adminPanel").classList.remove("hidden");loadAdminPanel();}
function toggleChat(){const c=document.getElementById("chatPanel");c.style.display=c.style.display==="flex"?"none":"flex";c.style.flexDirection="column";}

// --- Auth Functions ---
function signupFunc(){
  const email=document.getElementById("signupEmail").value.trim();
  const pass=document.getElementById("signupPass").value.trim();
  if(!email||!pass){alert("Fill fields"); return;}
  auth.createUserWithEmailAndPassword(email,pass).then(()=>{
    db.collection("users").doc(email).set({role:null,username:email});
    currentUser=email;updateUI();goHome();
  }).catch(e=>alert(e.message));
}
function loginFunc(){
  const email=document.getElementById("loginEmail").value.trim();
  const pass=document.getElementById("loginPass").value.trim();
  if(!email||!pass){alert("Fill fields"); return;}
  auth.signInWithEmailAndPassword(email,pass).then(()=>{currentUser=email;updateUI();goHome();}).catch(e=>alert(e.message));
}
function logout(){auth.signOut();currentUser=null;updateUI();goHome();}
function updateUI(){
  document.getElementById("loginBtn").classList.toggle("hidden",!!currentUser);
  document.getElementById("signupBtn").classList.toggle("hidden",!!currentUser);
  document.getElementById("accountBtn").classList.toggle("hidden",!currentUser);
  document.getElementById("roleCodeBtn").classList.toggle("hidden",!currentUser);
}

// --- Paste Functions ---
function publishPaste(){
  if(!currentUser){alert("Login first"); return;}
  const t=document.getElementById("pasteTitle").value.trim();
  const c=document.getElementById("pasteText").value.trim();
  if(!t||!c){alert("Fill fields"); return;}
  db.collection("pastes").add({title:t,text:c,author:currentUser,time:Date.now(),pinned:false});
  clearPaste(); goHome();
}
function clearPaste(){document.getElementById("pasteTitle").value="";document.getElementById("pasteText").value="";}
db.collection("pastes").orderBy("time","desc").onSnapshot(snap=>{
  pinned.innerHTML=""; recent.innerHTML="";
  snap.docs.forEach(d=>{
    const p=d.data(); const div=document.createElement("div"); div.className="paste";
    div.innerHTML=`<span>${p.title}</span><span>${p.author}</span>`;
    div.onclick=()=>alert(`${p.title}\nBy: ${p.author}\n\n${p.text}`);
    if(p.pinned)pinned.appendChild(div); else recent.appendChild(div);
  });
});
function searchPastes(q){q=q.toLowerCase();[...pinned.children,...recent.children].forEach(div=>{div.style.display=div.textContent.toLowerCase().includes(q)?"flex":"none";});}

// --- Account ---
function loadAccount(){db.collection("users").doc(currentUser).get().then(doc=>{if(doc.exists) document.getElementById("accName").textContent=doc.data().username||currentUser; loadUserPastes();});}
function updateUsername(){const n=prompt("New username:"); if(!n)return; db.collection("users").doc(currentUser).update({username:n}).then(()=>loadAccount());}
function loadUserPastes(){const container=document.getElementById("userPastes");container.innerHTML="";db.collection("pastes").where("author","==",currentUser).get().then(snap=>{snap.forEach(d=>{const div=document.createElement("div");div.textContent=d.data().title;container.appendChild(div);});});}

// --- Role Code ---
function enterRoleCode(){const code=document.getElementById("roleInput").value.trim();if(!currentUser)return;let role=null;if(code==="owner-code")role="owner";else if(code==="admin-code")role="admin";else{return alert("Invalid code");}db.collection("users").doc(currentUser).update({role}).then(()=>{alert(role+" activated");updateUI();goHome();});}

// --- Admin ---
function togglePermissions(){document.getElementById("permissionsPanel").classList.toggle("hidden");}
function loadAdminPanel(){const ul=document.getElementById("userList");const pl=document.getElementById("pasteList");ul.innerHTML="";pl.innerHTML="";db.collection("users").get().then(snap=>{snap.forEach(d=>{const div=document.createElement("div");div.textContent=d.id;ul.appendChild(div);});});db.collection("pastes").get().then(snap=>{snap.forEach(d=>{const p=d.data();const div=document.createElement("div");div.textContent=`${p.title} by ${p.author}`;pl.appendChild(div);});});}

// --- Chat ---
const chatInput=document.getElementById("chatInput");
const chatMessages=document.getElementById("chatMessages");
function sendChat(){const m=chatInput.value.trim(); if(!m||!currentUser)return; db.collection("chat").add({author:currentUser,text:m,time:Date.now()}); chatInput.value="";}
db.collection("chat").orderBy("time").onSnapshot(snap=>{chatMessages.innerHTML="";snap.docs.forEach(d=>{const m=d.data();const div=document.createElement("div");div.innerHTML=`<b>${m.author}:</b> ${m.text}`;chatMessages.appendChild(div);});chatMessages.scrollTop=chatMessages.scrollHeight;});

auth.onAuthStateChanged(u=>{currentUser=u?.email||null;updateUI();});
goHome();
</script>
</body>
</html>
